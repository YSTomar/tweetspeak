<div class="paper">
	<% flash.each do |name, msg| %>
    <% if msg.is_a?(String) %>
      <div class="alert alert-<%= name == :notice ? "success" : "danger" %> alert-dismissable">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        <%= content_tag :div, msg, :id => "flash_#{name}" %>
      </div>
    <% end %>
  <% end %>

<!-- Calculate Streak -->
<% now = current_user.current_sign_in_at.beginning_of_hour %>
  <% last = current_user.last_sign_in_at.beginning_of_hour %>
  <% streak_in_hours = (now - last)/3600 %>
  <% streak = 0 %>

  <% if streak_in_hours <= 24 %>
  	<% streak = streak += 1 %>
  <% else %>
  	<% d = streak_in_hours / 24 %>
  	<% streak = streak += d %>
  <% end %>

  <% @user = current_user %>
  
  <% if streak > @user.best_streak %>
  <% @user.best_streak = streak %>
  <% @user.save %>
  <% end %>
 
			<div class="page-header">
				<h1 style="font-family: 'Roboto Slab', serif;">Dashboard <br>
				<% if current_user.name? %>
				<small>Hey,
					<%= current_user.name %>! Ready to get started?</small>
				<% else %>
					<small>Hi! What's your name?</small> <%= link_to "Edit your name", edit_user_registration_path, class:"btn btn-danger" %>
    			<% end %>
				</h1>
				<div class="center" style="margin-bottom: 25px;">
					<%=link_to	"Go to Lesson!", current_user.next_lesson_path, class:"btn btn-primary btn-lg"
					%>
				</div>
			</div>

<%= link_to "Cancel Subscription", {:controller => :charges, :action => :cancel}, {:method => :post } %>

	<div class="dashboard row big-bottom">
		<div class="col-md-6">
			<div class="panel panel-default top-space">
				<div class="panel-heading">
						<h3 class="panel-title">Beat your best streak!</h3>
					</div>
					<div class="panel-body">
						<div class="progress">
		  				<div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="<%= (streak * 100) / @user.best_streak %>" aria-valuemin="0" aria-valuemax="100" style="width: <%= (streak * 100) / @user.best_streak %>%">
		    			<span class="sr-only"><%= (streak * 100) / @user.best_streak %>% Complete (success)</span>
		  				</div>
		  				</div>
		  				<p class="progress-label">Best streak: <strong><%= @user.best_streak %> Day<% unless @user.best_streak == 1
		  					 %> s<% end %>!</strong></p>
	  				</div>
	  		</div>
	  	</div>
		<div class="col-md-6">
			<div class="center">
				<h4>You currently have:</h4>
				<div class="points">
					<p>500 points!</p>
				</div>
			</div>
		</div>
	</div>

	<div class="center">
		<h3 style="font-family: 'Roboto Slab', serif;">Start today's lesson?</h3>
		<%= link_to "Let's go!", "#", class:"btn btn-primary btn-lg" %>
	</div>
</div>